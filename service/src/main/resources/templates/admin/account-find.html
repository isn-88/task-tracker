<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
  <link th:href="@{/css/icons.all.min.css}" rel="stylesheet">
  <title>Admin page</title>
</head>

<body>
<section>
  <div th:insert="~{fragments/nav :: account}"></div>
  <div th:insert="~{fragments/nav :: tab}"></div>
</section>


<section style="padding-top: 20px; padding-bottom: 10px;">
  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <div class="mb-5">
          <h5>Страница администратора</h5>
        </div>

        <div th:insert="~{fragments/nav :: admin}"></div>

        <!--      Поиск аккаунта    -->
        <div class="mt-3">
          <p class="lead"
             th:text="'Всего зарегистрировано аккаунтов: ' + ${totalItems}">Accounts</p>
        </div>

        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
            <form th:action="@{/admin/account/find}" method="GET">
              <tr>
                <th><p>Имя пользователя</p>
                  <p>
                    <input class="form-control form-control-sm" type="text"
                           name="username" th:value="${filter.username()}"
                           placeholder="" aria-label="Username">
                  </p>
                </th>
                <th scope="col"><p>ФИО</p>
                  <p>
                    <input class="form-control form-control-sm" type="text"
                           name="fullName" th:value="${filter.fullName()}"
                           placeholder="" aria-label="FullName">
                  </p>
                </th>
                <th scope="col"><p>Эл. адрес</p>
                  <p>
                    <input class="form-control form-control-sm" type="text"
                           name="email" th:value="${filter.email()}"
                           placeholder="" aria-label="Email">
                  </p>
                </th>
                <th scope="col"><p>Роль</p>
                  <p>
                    <select class="form-select form-select-sm w-auto" id="roleFilter" name="role">
                      <option value="" th:selected="${filter.role() eq null}">Любая</option>
                      <option th:each="role : ${roles}"
                              th:value="${role.name()}" th:text="${role.name()}"
                              th:selected="${filter?.role() eq role.name()}">Role
                      </option>
                    </select>
                  </p>
                </th>
                <th scope="col">
                  <p>Статус</p>
                  <p>
                    <select class="form-select form-select-sm w-auto"
                            id="statusFilter" name="status">
                      <option value="" th:selected="${filter.status() eq null}">Любой</option>
                      <option value="true"
                              th:selected="${filter.status() eq 'true'}">Активен
                      </option>
                      <option value="false"
                              th:selected="${filter.status() eq 'false'}">Заблокирован
                      </option>
                    </select>
                  </p>
                </th>
                <th scope="col"><p>Блокировка</p>
                  <p>
                    <button class="btn btn-sm btn-outline-secondary ms-2"
                            type="button" disabled>
                      <i class="fa-solid fa-ban"></i>
                    </button>
                  </p>
                </th>
                <th><p>Изменить</p>
                  <p>
                    <button class="btn btn-sm btn-outline-primary ms-2" type="submit">
                      <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                  </p>
                </th>
              </tr>
            </form>
            </thead>
            <tbody>
            <tr th:each="account : ${accounts}">
              <td th:text="${account.username()}">Username</td>

              <td><a th:href="@{/accounts/{id}(id=${account.id()})}"
                     th:text="${account.fullName()}">Full Name</a>
              </td>
              <td th:text="${account.email()}">Email
              </td>
              <td th:text="${account.role().name()}">Role
              </td>
              <td>
                <h5>
                  <span class="badge rounded-pill"
                        th:classappend="${account.isEnabled() ? 'text-bg-success' : 'text-bg-danger'}"
                        th:text="${account.isEnabled() ? 'Активен' : 'Заблокирован'}">Status</span>
                </h5>
              </td>
              <td>
                <form th:action="@{/admin/account/block}" method="POST">
                  <label>
                    <input hidden type="text" name="id" th:value="${account.id()}">
                  </label>
                  <label>
                    <input hidden type="text" name="isEnabled"
                           th:value="${not account.isEnabled()}">
                  </label>
                  <button type="submit" class="btn btn-sm"
                          th:classappend="${account.isEnabled() ? 'btn-outline-danger' : 'btn-outline-success'}">
                    <i th:class="${account.isEnabled() ? 'fa-solid fa-ban' : 'fa-regular fa-circle-check'}"></i>
                  </button>
                </form>
              </td>
              <td>
                <form th:action="@{/admin/account/find}" method="GET">
                  <label>
                    <input hidden type="text" name="id" th:value="${account.id()}">
                  </label>
                  <label>
                    <input hidden type="text" name="isEnabled"
                           th:value="${not account.isEnabled()}">
                  </label>
                  <button type="submit" class="btn btn-sm btn-outline-warning">
                    <i class="fa-regular fa-pen-to-square"></i>
                  </button>
                </form>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <nav aria-label="Pagination" th:if="${totalPages > 0}">
          <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage eq 1} ? 'disabled'">
              <a th:replace="~{fragments/nav :: paging(1, '<<', 'First Page')}"></a>
            </li>
            <li class="page-item font-weight-bold"
                th:classappend="${currentPage == 1} ? 'disabled'">
              <a th:replace="~{fragments/nav :: paging(${currentPage - 1}, 'Назад', 'Previous Page')}"></a>
            </li>
            <li class="page-item disabled" th:if="${currentPage - (navPages - 1) > 1}">
              <a class="page-link" href="#">...</a>
            </li>
            <li class="page-item" th:classappend="${page == currentPage} ? 'active'"
                th:each="page : ${#numbers.sequence((currentPage > (navPages - 1) ? currentPage - (navPages - 1) : 1),
                (currentPage + (navPages - 1) < totalPages ? currentPage + (navPages - 1) : totalPages))}">
              <a th:replace="~{fragments/nav :: paging(${page}, ${page}, 'Page ' + ${page})}"></a>
            </li>
            <li class="page-item disabled" th:if="${currentPage + (navPages - 1) < totalPages}">
              <a class="page-link" href="#">...</a>
            </li>
            <li class="page-item font-weight-bold"
                th:classappend="${currentPage == totalPages} ? 'disabled'">
              <a th:replace="~{fragments/nav :: paging(${currentPage + 1},'Вперёд', 'Next Page')}"></a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
              <a th:replace="~{fragments/nav :: paging(${totalPages}, '>>', 'Last Page')}"></a>
            </li>
          </ul>
        </nav>

      </div>
    </div>
  </div>
</section>


<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>

</html>